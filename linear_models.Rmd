---
title: "linear_modeling_moonlander_eye_data"
author: "Nils Wendel Heinrich"
date: '2023-02-17'
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages, include=FALSE}
library(tidyverse)
library(lme4)
library(lmerTest)
library(sjPlot)
library(latex2exp)
library(ggplot2)
library(fitdistrplus)
library(simr)
```


```{r eye_data, include=FALSE}

setwd('/Users/heinrich/Projects/eye_movement_analysis_moonlander/')

data_fixations <- read_csv("eye_data/experimental_eye_data_fixations.csv")
data_saccades <- read_csv("eye_data/experimental_eye_data_saccades.csv")

```
We have data from 27 participants. Exclusion took place and will have to be specified here...

```{r edit_data, include=FALSE}

# level difficulty
# Most likely we won't use level difficulty as fixed effect. But we will nevertheless relevel it.
## fixations
data_fixations <- data_fixations %>%
  mutate(level_difficulty = case_when(
    (level == 1 | level == 2) ~ "easy",
    (level == 3 | level == 4) ~ "medium",
    (level == 5 | level == 6) ~ "hard",
    ))
data_fixations$level_difficulty <- as.factor(data_fixations$level_difficulty)
data_fixations <- within(data_fixations, level_difficulty <- relevel(level_difficulty, ref = "easy"))
## saccades
data_saccades <- data_saccades %>%
  mutate(level_difficulty = case_when(
    (level == 1 | level == 2) ~ "easy",
    (level == 3 | level == 4) ~ "medium",
    (level == 5 | level == 6) ~ "hard",
    ))
data_saccades$level_difficulty <- as.factor(data_saccades$level_difficulty)
data_saccades <- within(data_saccades, level_difficulty <- relevel(level_difficulty, ref = "easy"))

# input noise
## fixations
data_fixations$input_noise <- as.factor(data_fixations$input_noise)
data_fixations <- within(data_fixations, input_noise <- relevel(input_noise, ref = "N"))
## saccades
data_saccades$input_noise <- as.factor(data_saccades$input_noise)
data_saccades <- within(data_saccades, input_noise <- relevel(input_noise, ref = "N"))

```

```{r plotting_theme, echo=FALSE}

set_theme(
  base = theme_bw(),
  geom.outline.color = "antiquewhite4",
  legend.inside = TRUE,
  geom.label.size = 3
)

```

# Effects coding

We are especially interested in exlporing effects of *input noise* in our predicted variables. Input noise means the internal loss of control. We will put it against *drift*, the external loss of control as well as account for the number of obstacles on the screen which might mainly drive changes in the predicted variable.

We want to apply our own effects coding for the variables of level_difficulty and input_noise.
```{r effects_coding, include=TRUE}

# both variables have 3 levels. Therefore we can go for a single matrix. We want to test level 2 against level 1, then level 3 against level 1, and last level 3 against level 2.
#effects_coding <- contr.treatment(3)

#effects_coding <- cbind( c(0,1,0), c(0,0,1), c(0,-1,1))
#contrasts(data_fixations$input_noise) = effects_coding

# this changes the base to level 2
#data_fixations$input_noise <- as.factor(data_fixations$input_noise)
#contrasts(data_fixations$input_noise) = contr.treatment(3, base = 2)

```

# Predicting fixations

Fixations may have served various functions. We will try to account for it and differentiate between resting and exploring fixations. 
```{r splitting_fixations, include=TRUE}

# only considering fixations with duration > 0:
data_fixations <- data_fixations[data_fixations$fixation_duration > 0, ]
# The eye tracker might have flagged single frames as fixations. These would have lasted no time and we will simply filter them out.

# distinguishing exploring and resting fixations
#x_sp = 972
#y_sp = 288

# 4° is half of the span of the parafovea. We will use that as the threshold (keeping the spaceship clearly visible vs. not)
#threshold = 4

#data_fixations$distance_to_spaceship <- sqrt((data_fixations$converging_eye_x_adjusted - x_sp)**2 + (data_fixations$converging_eye_y_adjusted - y_sp)**2)

exploring_fixations <- data_fixations[data_fixations$exploring_fixation == 1, ]
resting_fixations <- data_fixations[data_fixations$exploring_fixation == 0, ]

```

## Resting fixations - Fixation duration (s)

```{r check_fixDur_rest_fit, include=TRUE}

hist(resting_fixations$fixation_duration, breaks=200)

resting_fixations$fixation_duration.log <- log(resting_fixations$fixation_duration)

fit.gauss <- fitdist(resting_fixations$fixation_duration.log, distr = "norm", method = "mme")
summary(fit.gauss)
plot(fit.gauss)

#fit.gamma <- fitdist(resting_fixations$fixation_duration, distr = "gamma", method = "mme")
#summary(fit.gamma)
#plot(fit.gamma)

```

```{r random_effects, include=TRUE}

fixDur_rest_null <- lmer(fixation_duration ~ 1 + (1|ID), data=resting_fixations, REML = FALSE)
summary(fixDur_rest_null)

```

```{r ICC_fixDur_rest, include=TRUE}

ICC_fixDur_rest <- 0.02642 / (0.02642 + 0.10944)
ICC_fixDur_rest

```

```{r fixation_duration_rest, include=TRUE}

pred_fixDur_rest <- lmer(fixation_duration.log ~ N_visible_obstacles * N_visible_drift_tiles + input_noise + (1|ID), data=resting_fixations, REML = FALSE)

#pred_fixDur_rest.slope <- lmer(fixation_duration.log ~ N_visible_obstacles * N_visible_drift_tiles + #input_noise + (1+N_visible_obstacles|ID), data=resting_fixations, REML = FALSE) # model does not converge

pred_fixDur_rest.slope2 <- lmer(fixation_duration.log ~ N_visible_obstacles * N_visible_drift_tiles + input_noise + (1+N_visible_drift_tiles|ID), data=resting_fixations, REML = FALSE)

#anova(pred_fixDur_rest, pred_fixDur_rest.slope, pred_fixDur_rest.slope2)

anova(pred_fixDur_rest, pred_fixDur_rest.slope2)

summary(pred_fixDur_rest.slope2)

```

```{r plot_fixation_duration_rest, echo=FALSE}

plot_fixDurRest <- plot_model(pred_fixDur_rest.slope2, 
           type = "pred", 
           terms = c("N_visible_obstacles", "N_visible_drift_tiles", "input_noise"),
           title = "",
           colors = "Set2",
           legend.title = TeX("$N_{ drift_{ visible}}$")
           )

# additional layout stuff
plot_fixDurRest <- plot_fixDurRest + 
  xlab(TeX("$N_{ obstacles_{ visible}}$")) +
  xlim(0, 15) +
  ylab("Fixation Duration (s)")

plot_fixDurRest
```

Discussing the results: ...

```{r eval=TRUE, cache=TRUE}
# fixed effects
fixef(pred_fixDur_rest.slope2)

# profiling
#p_lmm <- profile(lmm, which="beta_")
#confint(p_lmm)

# bootstrap
confint(pred_fixDur_rest.slope2, nsim=100, parm=c("N_visible_obstacles", "N_visible_drift_tiles", "input_noiseS", "input_noiseW"), method="boot")

# Wald
confint(pred_fixDur_rest.slope2,parm=c("N_visible_obstacles", "N_visible_drift_tiles", "input_noiseS", "input_noiseW"),
        method="Wald")

confint(pred_fixDur_rest.slope2,parm="input_noise",
        method="Wald")
```

## Resting fixations - Fixation location (distance to spaceship in visual degrees)

```{r check_distSpaceship_rest_fit, include=TRUE}

hist(resting_fixations$distance_to_spaceship, breaks=200)

fit.gauss <- fitdist(c(na.exclude(resting_fixations$distance_to_spaceship)), distr = "norm", method = "mme")
summary(fit.gauss)
plot(fit.gauss)

```

```{r random_effects, include=TRUE}

distSpaceship_rest_null <- lmer(distance_to_spaceship ~ 1 + (1|ID), data=resting_fixations, REML=FALSE)
summary(distSpaceship_rest_null)

```

```{r ICC_distSpaceship_rest, include=TRUE}

ICC_distSpaceship_rest <- 0.08396 / (0.08396 + 1.01570)
ICC_distSpaceship_rest

```

```{r distance_to_spaceship_rest, include=TRUE}

pred_distSpaceship_rest <- lmer(distance_to_spaceship ~ N_visible_obstacles * N_visible_drift_tiles + input_noise + (1|ID), data=resting_fixations, REML = FALSE)

pred_distSpaceship_rest.slope <- lmer(distance_to_spaceship ~ N_visible_obstacles * N_visible_drift_tiles + input_noise + (1+N_visible_obstacles|ID), data=resting_fixations, REML = FALSE)  # does not converge

pred_distSpaceship_rest.slope2 <- lmer(distance_to_spaceship ~ N_visible_obstacles * N_visible_drift_tiles + input_noise + (1+N_visible_drift_tiles|ID), data=resting_fixations, REML = FALSE)

anova(pred_distSpaceship_rest, pred_distSpaceship_rest.slope2)

summary(pred_distSpaceship_rest.slope2)

```

```{r plot_distance_to_spaceship_rest, echo=FALSE}

plot_distSpaceshipRest <- plot_model(pred_distSpaceship_rest.slope2, 
           type = "pred", 
           terms = c("N_visible_obstacles", "N_visible_drift_tiles", "input_noise"),
           title = "",
           colors = "Set2",
           legend.title = TeX("$N_{ drift_{ visible}}$")
           )

# additional layout stuff
plot_distSpaceshipRest <- plot_distSpaceshipRest + 
  xlab(TeX("$N_{ obstacles_{ visible}}$")) +
  xlim(0, 15) +
  ylab("Distance to Spaceship (visual degrees°)")

plot_distSpaceshipRest
```

Discussing the results: ...

```{r eval=TRUE, cache=TRUE}
# fixed effects
fixef(pred_distSpaceship_rest.slope2)

# bootstrap
confint(pred_distSpaceship_rest.slope2, nsim=100, parm=c("N_visible_obstacles", "N_visible_drift_tiles", "input_noiseS", "N_visible_obstacles:N_visible_drift_tiles"), method="boot")

#confint(pred_distSpaceship_rest.slope2, nsim=100, parm=c("input_noiseS", #"N_visible_obstacles:N_visible_drift_tiles"), method="boot")

# Wald
#confint(pred_fixDur_rest.slope2,parm=c("N_visible_obstacles", "N_visible_drift_tiles", "input_noiseS", #"input_noiseW"), method="Wald")

```

## Exploring fixations - Fixation duration (s)

```{r check_fixDur_explore_fit, include=TRUE}

hist(exploring_fixations$fixation_duration, breaks=200)

exploring_fixations$fixation_duration.log <- log(exploring_fixations$fixation_duration)

fit.gauss <- fitdist(exploring_fixations$fixation_duration.log, distr = "norm", method = "mme")
summary(fit.gauss)
plot(fit.gauss)

```

```{r random_effects, include=TRUE}

fixDur_explore_null <- lmer(fixation_duration ~ 1 + (1|ID), data=exploring_fixations, REML = FALSE)
summary(fixDur_explore_null)

```

```{r ICC_fixDur_explore, include=TRUE}

ICC_fixDur_explore <- 0.02030 / (0.02030 + 0.09249)
ICC_fixDur_explore

```

```{r fixation_duration_explore, include=TRUE}

pred_fixDur_explore <- lmer(fixation_duration.log ~ N_visible_obstacles * N_visible_drift_tiles + input_noise + (1|ID), data=exploring_fixations, REML = FALSE)

pred_fixDur_explore.slope <- lmer(fixation_duration.log ~ N_visible_obstacles * N_visible_drift_tiles + input_noise + (1+N_visible_obstacles|ID), data=exploring_fixations, REML = FALSE)

pred_fixDur_explore.slope2 <- lmer(fixation_duration.log ~ N_visible_obstacles * N_visible_drift_tiles + input_noise + (1+N_visible_drift_tiles|ID), data=exploring_fixations, REML = FALSE)

pred_fixDur_explore.slope3 <- lmer(fixation_duration.log ~ N_visible_obstacles * N_visible_drift_tiles + input_noise + (1+input_noise|ID), data=exploring_fixations, REML = FALSE) # model fails to converge

anova(pred_fixDur_explore, pred_fixDur_explore.slope, pred_fixDur_explore.slope2)

summary(pred_fixDur_explore.slope)

```

```{r plot_fixation_duration_explore, echo=FALSE}

plot_fixDur_explore <- plot_model(pred_fixDur_explore.slope, 
           type = "pred", 
           terms = c("N_visible_obstacles", "N_visible_drift_tiles", "input_noise"),
           title = "",
           colors = "Set2",
           legend.title = TeX("$N_{ drift_{ visible}}$")
           )

# additional layout stuff
plot_fixDur_explore <- plot_fixDur_explore + 
  xlab(TeX("$N_{ obstacles_{ visible}}$")) +
  xlim(0, 15) +
  ylab("Fixation duration (s)")

plot_fixDur_explore
```

Discussing the results: ...

```{r eval=TRUE, cache=TRUE}
# fixed effects
fixef(pred_fixDur_explore.slope)

# bootstrap
confint(pred_fixDur_explore.slope, nsim=100, parm=c("N_visible_obstacles", "N_visible_drift_tiles", "input_noiseS", "input_noiseW", "N_visible_obstacles:N_visible_drift_tiles"), method="boot")

confint(pred_fixDur_explore.slope, nsim=100, parm=c("input_noiseS", "input_noiseW",  "N_visible_obstacles:N_visible_drift_tiles"), method="boot")

# Wald
#confint(pred_fixDur_rest.slope2,parm=c("N_visible_obstacles", "N_visible_drift_tiles", "input_noiseS", #"input_noiseW"), method="Wald")

```

## Exploring fixations - Fixation location (distance to spaceship in visual degrees)

```{r check_distSpaceship_explore_fit, include=TRUE}

hist(exploring_fixations$distance_to_spaceship, breaks=200)

exploring_fixations$distance_to_spaceship.log <- log(exploring_fixations$distance_to_spaceship)

fit.gauss <- fitdist(c(na.exclude(exploring_fixations$distance_to_spaceship.log)), distr = "norm", method = "mme")
summary(fit.gauss)
plot(fit.gauss)

#lnorm: AIC:  374016.8   BIC:  374034.8
#gamma: AIC:  400144.8   BIC:  400162.8
#exp: AIC:  407156.6   BIC:  407165.6

#log-transformed with norm: AIC:  103144.4   BIC:  103162.4

```

```{r random_effects, include=TRUE}

distSpaceship_explore_null <- lmer(distance_to_spaceship.log ~ 1 + (1|ID), data=exploring_fixations, REML = FALSE)
summary(distSpaceship_explore_null)

```

```{r ICC_distSpaceship_explore, include=TRUE}

ICC_distSpaceship_explore <- 0.05163 / (0.05163 + 0.24074)
ICC_distSpaceship_explore

```

```{r distance_to_spaceship_explore, include=TRUE}

pred_distSpaceship_explore <- lmer(distance_to_spaceship.log ~ N_visible_obstacles * N_visible_drift_tiles + input_noise + (1|ID), data=exploring_fixations, REML = FALSE)

pred_distSpaceship_explore.slope <- lmer(distance_to_spaceship.log ~ N_visible_obstacles * N_visible_drift_tiles + input_noise + (1+N_visible_obstacles|ID), data=exploring_fixations, REML = FALSE)
#model fails to converge

pred_distSpaceship_explore.slope2 <- lmer(distance_to_spaceship.log ~ N_visible_obstacles * N_visible_drift_tiles + input_noise + (1+N_visible_drift_tiles|ID), data=exploring_fixations, REML = FALSE)

anova(pred_distSpaceship_explore, pred_distSpaceship_explore.slope2)

summary(pred_distSpaceship_explore.slope2)

```

```{r plot_distance_to_spaceship_explore, echo=FALSE}

plot_distSpaceship_explore <- plot_model(pred_distSpaceship_explore.slope2, 
           type = "pred", 
           terms = c("N_visible_obstacles", "N_visible_drift_tiles", "input_noise"),
           title = "",
           colors = "Set2",
           legend.title = TeX("$N_{ drift_{ visible}}$")
           )

# additional layout stuff
plot_distSpaceship_explore <- plot_distSpaceship_explore + 
  xlab(TeX("$N_{ obstacles_{ visible}}$")) +
  xlim(0, 15) +
  ylab("Distance to Spaceship (visual degrees°)")

plot_distSpaceship_explore
```

Discussing the results: ...

```{r eval=TRUE, cache=TRUE}
# fixed effects
fixef(pred_distSpaceship_explore.slope2)

# bootstrap
confint(pred_distSpaceship_explore.slope2, nsim=100, parm=c("N_visible_obstacles", "N_visible_drift_tiles", "input_noiseS", "input_noiseW", "N_visible_obstacles:N_visible_drift_tiles"), method="boot")

#confint(pred_fixDur_explore.slope, nsim=100, parm=c("input_noiseS", "input_noiseW",  "N_visible_obstacles:N_visible_drift_tiles"), method="boot")

# Wald
#confint(pred_fixDur_rest.slope2,parm=c("N_visible_obstacles", "N_visible_drift_tiles", "input_noiseS", #"input_noiseW"), method="Wald")

```

# Predicting saccades

Saccades may have served various functions. We will try to account for it and differentiate between progressive and regressive saccades. 
```{r splitting_saccades, include=TRUE}

data_saccades <- data_saccades[data_saccades$saccade_amplitude > 0 & data_saccades$saccade_amplitude < 27, ]
# filter saccades that have no saccade amplitude
data_saccades <- data_saccades[!is.na(data_saccades$saccade_amplitude),]

progressive_saccades <- data_saccades[data_saccades$saccade_direction_y < 0, ]
regressive_saccades <- data_saccades[data_saccades$saccade_direction_y > 0, ]

```

## Progressive saccades - Saccade amplitude (in visual degrees)

```{r check_saccAmp_progress_fit, include=TRUE}

hist(progressive_saccades$saccade_amplitude, breaks=200)

progressive_saccades$saccade_amplitude.log <- log(progressive_saccades$saccade_amplitude)

fit.gauss <- fitdist(progressive_saccades$saccade_amplitude.log, distr = "norm", method = "mme")
summary(fit.gauss)
plot(fit.gauss)

#Gamma: AIC:  137235.3   BIC:  137251.8 
#log-transformed with norm: AIC:  101111.7   BIC:  101128.1 

```

```{r random_effects, include=TRUE}

saccAmp_progress_null <- lmer(saccade_amplitude.log ~ 1 + (1|ID), data=progressive_saccades, REML = FALSE)
summary(saccAmp_progress_null)

```

```{r ICC_saccAmp_progress, include=TRUE}

ICC_saccAmp_progress <- 0.213 / (0.213 + 2.101)
ICC_saccAmp_progress

```

```{r saccAmp_progress, include=TRUE}

pred_saccAmp_progress <- lmer(saccade_amplitude.log ~ N_visible_obstacles * N_visible_drift_tiles + input_noise + (1|ID), data=progressive_saccades, REML = FALSE)

pred_saccAmp_progress.slope <- lmer(saccade_amplitude.log ~ N_visible_obstacles * N_visible_drift_tiles + input_noise + (1+N_visible_obstacles|ID), data=progressive_saccades, REML = FALSE) # model fails to converge

pred_saccAmp_progress.slope2 <- lmer(saccade_amplitude.log ~ N_visible_obstacles * N_visible_drift_tiles + input_noise + (1+N_visible_drift_tiles|ID), data=progressive_saccades, REML = FALSE)

anova(pred_saccAmp_progress, pred_saccAmp_progress.slope2)

summary(pred_saccAmp_progress.slope2)

```

```{r plot_saccAmp_progress, echo=FALSE}

plot_saccAmp_progress <- plot_model(pred_saccAmp_progress.slope2, 
           type = "pred", 
           terms = c("N_visible_obstacles", "N_visible_drift_tiles", "input_noise"),
           title = "",
           colors = "Set2",
           legend.title = TeX("$N_{ drift_{ visible}}$")
           )

# additional layout stuff
plot_saccAmp_progress <- plot_saccAmp_progress + 
  xlab(TeX("$N_{ obstacles_{ visible}}$")) +
  xlim(0, 15) +
  ylab("Saccade amplitude (visual degrees°)")

plot_saccAmp_progress
```

Discussing the results: ...

```{r eval=TRUE, cache=TRUE}
# fixed effects
fixef(pred_saccAmp_progress.slope2)

# bootstrap
confint(pred_saccAmp_progress.slope2, nsim=100, parm=c("N_visible_obstacles", "input_noiseS", "input_noiseW", "N_visible_obstacles:N_visible_drift_tiles"), method="boot")

```

## Progressive saccades - distance to closest obstacle (in pixel)

```{r check_distObs_progress_fit, include=TRUE}

hist(progressive_saccades$saccLandSite_dist_to_closestObstacle, breaks=200)

hist(log(progressive_saccades$saccLandSite_dist_to_closestObstacle), breaks=200)

progressive_saccades$saccLandSite_dist_to_closestObstacle.log <- log(progressive_saccades$saccLandSite_dist_to_closestObstacle)

fit.gauss <- fitdist(c(na.exclude(progressive_saccades$saccLandSite_dist_to_closestObstacle.log)), distr = "norm", method = "mme")
summary(fit.gauss)
plot(fit.gauss)

```

```{r random_effects, include=TRUE}

distObs_explore_null <- lmer(saccLandSite_dist_to_closestObstacle.log ~ 1 + (1|ID), data=progressive_saccades, REML = FALSE)
summary(distObs_explore_null)

```

```{r ICC_distObs_progress, include=TRUE}

ICC_distObs_progress <- 0.1006 / (0.1006 + 0.7920)
ICC_distObs_progress

```

```{r distObs_progress, include=TRUE}

pred_distObs_progress <- lmer(saccLandSite_dist_to_closestObstacle.log ~ N_visible_obstacles * N_visible_drift_tiles + input_noise + (1|ID), data=progressive_saccades, REML = FALSE)

pred_distObs_progress.slope <- lmer(saccLandSite_dist_to_closestObstacle.log ~ N_visible_obstacles * N_visible_drift_tiles + input_noise + (1+N_visible_obstacles|ID), data=progressive_saccades, REML = FALSE)
# model fails to converge

pred_distObs_progress.slope2 <- lmer(saccLandSite_dist_to_closestObstacle.log ~ N_visible_obstacles * N_visible_drift_tiles + input_noise + (1+N_visible_drift_tiles|ID), data=progressive_saccades, REML = FALSE)

pred_distObs_progress.slope3 <- lmer(saccLandSite_dist_to_closestObstacle.log ~ N_visible_obstacles * N_visible_drift_tiles + input_noise + (1+input_noise|ID), data=progressive_saccades, REML = FALSE)

anova(pred_distObs_progress, pred_distObs_progress.slope2, pred_distObs_progress.slope3)

summary(pred_distObs_progress.slope3)

```

```{r plot_distance_to_obstacles_progress, echo=FALSE}

plot_distObs_progress <- plot_model(pred_distObs_progress.slope3, 
           type = "pred", 
           terms = c("N_visible_obstacles", "N_visible_drift_tiles", "input_noise"),
           title = "",
           colors = "Set2",
           legend.title = TeX("$N_{ drift_{ visible}}$")
           )

# additional layout stuff
plot_distObs_progress <- plot_distObs_progress + 
  xlab(TeX("$N_{ obstacles_{ visible}}$")) +
  xlim(0, 15) +
  ylab("Distance to nearest obstacle (in pixel)")

plot_distObs_progress
```

Discussing the results: ...

```{r eval=TRUE, cache=TRUE}
# fixed effects
fixef(pred_distObs_progress.slope3)

# bootstrap
confint(pred_distObs_progress.slope3, nsim=100, parm=c("N_visible_obstacles"), method="boot")

```

## Regressive saccades - Saccade amplitude

```{r check_saccAmp_regress_fit, include=TRUE}

hist(regressive_saccades$saccade_amplitude, breaks=200)

hist(log(regressive_saccades$saccade_amplitude), breaks=200)

regressive_saccades$saccade_amplitude.log <- log(regressive_saccades$saccade_amplitude)

fit.gauss <- fitdist(regressive_saccades$saccade_amplitude.log, distr = "norm", method = "mme")
summary(fit.gauss)
plot(fit.gauss)

```

```{r random_effects, include=TRUE}

saccAmp_regress_null <- lmer(saccade_amplitude ~ 1 + (1|ID), data=regressive_saccades, REML = FALSE)
summary(saccAmp_regress_null)

```

```{r ICC_saccAmp_regress, include=TRUE}

ICC_saccAmp_regress <- 0.6771 / (0.6771 + 15.3863)
ICC_saccAmp_regress

```

```{r saccAmp_regress, include=TRUE}

# ID does not explain variance in the predicted variable. We might therefore omit including it as random effect
pred_saccAmp_regress <- lm(saccade_amplitude.log ~ N_visible_obstacles * N_visible_drift_tiles + input_noise, data=regressive_saccades)
summary(pred_saccAmp_regress)

```

```{r plot_saccAmp_regress, echo=FALSE}

plot_saccAmp_regress <- plot_model(pred_saccAmp_regress, 
           type = "pred", 
           terms = c("N_visible_obstacles", "N_visible_drift_tiles", "input_noise"),
           title = "",
           colors = "Set2",
           legend.title = TeX("$N_{ drift_{ visible}}$")
           )

# additional layout stuff
plot_saccAmp_regress <- plot_saccAmp_regress + 
  xlab(TeX("$N_{ obstacles_{ visible}}$")) +
  xlim(0, 15) +
  ylab("Saccade amplitude (visual degrees°)")

plot_saccAmp_regress
```

Discussing the results: ...

## Regressive saccades - distance to spaceship

```{r check_distSpaceship_regress_fit, include=TRUE}

hist(regressive_saccades$saccLandSite_dist_to_spaceship, breaks=200)

fit.gauss <- fitdist(regressive_saccades$saccade_amplitude, distr = "norm", method = "mme")
summary(fit.gauss)
plot(fit.gauss)

```

```{r random_effects, include=TRUE}

distSpaceship_regress_null <- lmer(saccLandSite_dist_to_spaceship ~ 1 + (1|ID), data=regressive_saccades, REML = FALSE)
summary(distSpaceship_regress_null)

```

```{r ICC_distSpaceship_regress, include=TRUE}

ICC_distSpaceship_regress <- 53.49 / (53.49 + 234.88)
ICC_distSpaceship_regress

```

```{r distSpaceship_regress, include=TRUE}

pred_distSpaceship_regress <- lmer(saccLandSite_dist_to_spaceship ~ N_visible_obstacles * N_visible_drift_tiles + input_noise + (1|ID), data=regressive_saccades, REML = FALSE)

pred_distSpaceship_regress.slope <- lmer(saccLandSite_dist_to_spaceship ~ N_visible_obstacles * N_visible_drift_tiles + input_noise + (1+N_visible_obstacles|ID), data=regressive_saccades, REML = FALSE) # does not converge

pred_distSpaceship_regress.slope2 <- lmer(saccLandSite_dist_to_spaceship ~ N_visible_obstacles * N_visible_drift_tiles + input_noise + (1+N_visible_drift_tiles|ID), data=regressive_saccades, REML = FALSE)

pred_distSpaceship_regress.slope3 <- lmer(saccLandSite_dist_to_spaceship ~ N_visible_obstacles * N_visible_drift_tiles + input_noise + (1+input_noise|ID), data=regressive_saccades, REML = FALSE)

anova(pred_distSpaceship_regress, pred_distSpaceship_regress.slope2, pred_distSpaceship_regress.slope3)

summary(pred_distSpaceship_regress.slope3)

```

```{r plot_distance_to_spaceship_regress, echo=FALSE}

plot_distSpaceship_regress <- plot_model(pred_distSpaceship_regress.slope3, 
           type = "pred", 
           terms = c("N_visible_obstacles", "N_visible_drift_tiles", "input_noise"),
           title = "",
           colors = "Set2",
           legend.title = TeX("$N_{ drift_{ visible}}$")
           )

# additional layout stuff
plot_distSpaceship_regress <- plot_distSpaceship_regress + 
  xlab(TeX("$N_{ obstacles_{ visible}}$")) +
  xlim(0, 15) +
  ylab("Distance to Spaceship (visual degrees°)")

plot_distSpaceship_regress
```

```{r eval=TRUE, cache=TRUE}
# fixed effects
fixef(pred_distSpaceship_regress.slope3)

# bootstrap
confint(pred_distSpaceship_regress.slope3, nsim=100, parm=c("N_visible_obstacles", "N_visible_drift_tiles"), method="boot")

```

Discussing the results: ...

# Input data - input duration

```{r input_data, include=FALSE}

input_data <- read_csv("input_data/input_data.csv")

# only considering those inputs that lasted for more than a single frame =0.033s and shorter than 2.45s (time for instance to completely be solved) -> no guarantee to pursue goals but steer blindly
#input_data <- input_data[input_data$input_duration > 0.033, ]
input_data <- input_data[input_data$input_duration > 0.033 & input_data$input_duration < 2.45, ]
input_data <- input_data %>% filter(!is.na(input_duration))

input_data$input_noise <- as.factor(input_data$input_noise)
input_data <- within(input_data, input_noise <- relevel(input_noise, ref = "N"))

```

```{r input_duration_input, include=TRUE}

hist(input_data$input_duration, breaks=200)

hist(log(input_data$input_duration), breaks=200)

input_data$input_duration.log <- log(input_data$input_duration)

fit.gauss <- fitdist(c(na.exclude(input_data$input_duration.log)), distr = "norm", method = "mme")
summary(fit.gauss)
plot(fit.gauss)

```

```{r random_effects, include=TRUE}

inputDur_null <- lmer(input_duration.log ~ 1 + (1|ID), data=input_data, REML = FALSE)
summary(inputDur_null)

```

```{r ICC_inputDur, include=TRUE}

ICC_inputDur <- 0.05978 / (0.05978 + 0.47762)
ICC_inputDur

```

```{r inputDur, include=TRUE}

inputDur <- lmer(input_duration.log ~ N_visible_obstacles * N_visible_drift_tiles + input_noise + (1|ID), data=input_data, REML = FALSE)

inputDur.slope <- lmer(input_duration.log ~ N_visible_obstacles * N_visible_drift_tiles + input_noise + (1+N_visible_obstacles|ID), data=input_data, REML = FALSE) # model fails to converge

inputDur.slope2 <- lmer(input_duration.log ~ N_visible_obstacles * N_visible_drift_tiles + input_noise + (1+N_visible_drift_tiles|ID), data=input_data, REML = FALSE)

inputDur.slope3 <- lmer(input_duration.log ~ N_visible_obstacles * N_visible_drift_tiles + input_noise + (1+input_noise|ID), data=input_data, REML = FALSE)

anova(inputDur, inputDur.slope2, inputDur.slope3)

summary(inputDur.slope2)

```

```{r plot_input_duration, echo=FALSE}

plot_inputDur <- plot_model(inputDur.slope2, 
           type = "pred", 
           terms = c("N_visible_obstacles", "N_visible_drift_tiles", "input_noise"),
           title = "",
           colors = "Set2",
           legend.title = TeX("$N_{ drift_{ visible}}$")
           )

# additional layout stuff
plot_inputDur <- plot_inputDur + 
  xlab(TeX("$N_{ obstacles_{ visible}}$")) +
  xlim(0, 15) +
  ylab("Input duration (s)")

plot_inputDur
```

```{r eval=TRUE, cache=TRUE}
# fixed effects
fixef(inputDur.slope2)

# bootstrap
confint(inputDur.slope2, nsim=100, parm=c("N_visible_obstacles", "N_visible_drift_tiles", "N_visible_obstacles:N_visible_drift_tiles"), method="boot")

```

# Responses to SoC questionnaire after each trial

```{r soc, include=TRUE}

soc_data <- read_csv("soc_data/soc_data.csv")

soc_data <- soc_data %>%
  mutate(level_difficulty = case_when(
    (level == 1 | level == 2) ~ "easy",
    (level == 3 | level == 4) ~ "medium",
    (level == 5 | level == 6) ~ "hard",
    ))
soc_data$level_difficulty <- as.factor(soc_data$level_difficulty)
soc_data <- within(soc_data, level_difficulty <- relevel(level_difficulty, ref = "easy"))

soc_data$input_noise <- as.factor(soc_data$input_noise)
soc_data <- within(soc_data, input_noise <- relevel(input_noise, ref = "N"))

table(soc_data$SoC)

```

```{r soc_fit, include=TRUE}

hist(soc_data$SoC, breaks=7)

fit.gauss <- fitdist(c(na.exclude(soc_data$SoC)), distr = "norm", method = "mme")
summary(fit.gauss)
plot(fit.gauss)

# AIC_gamma: 5600.357
# AIC_norm: 5124.438
```

```{r random_effects, include=TRUE}

soc_null <- lmer(SoC ~ 1 + (1|ID), data=soc_data, REML = FALSE)
summary(soc_null)

```

```{r ICC_soc, include=TRUE}

ICC_soc <- 0.3287 / (0.3287 + 2.4395)
ICC_soc

```

```{r soc, include=TRUE}

soc_model <- lmer(SoC ~ done + drift*level_difficulty + input_noise + (1|ID),  data = soc_data, REML = FALSE)

soc_model.slope <- lmer(SoC ~ done + drift*level_difficulty + input_noise + (1+done|ID),  data = soc_data, REML = FALSE)

soc_model.slope2 <- lmer(SoC ~ done + drift*level_difficulty + input_noise + (1+drift*level_difficulty|ID),  data = soc_data, REML = FALSE)  # isSingular...

soc_model.slope3 <- lmer(SoC ~ done + drift*level_difficulty + input_noise + (1+input_noise|ID),  data = soc_data, REML = FALSE)  # isSingular...

anova(soc_model, soc_model.slope)

summary(soc_model.slope)

```

```{r plot_soc, echo=FALSE}
# logical do not work...
plot_soc <- plot_model(soc_model.slope, 
           type = "pred", 
           terms = c("done", "drift", "level_difficulty", "input_noise"),
           title = "",
           colors = "Set2",
           legend.title = TeX("$factor lines$")
           )

# additional layout stuff
plot_soc <- plot_soc + 
  xlab(TeX("$factor on x-axis$")) +
  #xlim(0, ?) +
  ylab("SoC responded")

plot_soc
```

Discussing the results: ...
